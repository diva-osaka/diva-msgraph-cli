---
name: respond-to-pr-review
description: |
  PRレビューコメントへの対応を支援するスキル。直近のPRについたレビュアーのコメントを取得し、対応方針を検討・提示する。

  使用タイミング:
  - PRにレビューコメントがついた後、対応を検討したいとき
  - 「レビューコメントを確認して」「PRのフィードバックに対応して」などのリクエスト
  - /respond-to-pr-review または /respond-to-pr-review <PR番号> で呼び出し

  機能:
  - /pr-comments ビルトインコマンドでレビューコメントを取得
  - 各コメントの対応要否を根拠とともに判断・提示
  - ユーザー確認後、TDD手順で修正を実装
---

# PRレビューコメント対応スキル

## ワークフロー

### 1. PR特定とコメント取得

#### ビルトインコマンドでコメント取得

`/pr-comments` ビルトインコマンドを使用してPRコメントを取得する:

```
/pr-comments
```

このコマンドは以下を自動的に行う:
- 現在のブランチに関連するPRを特定
- PR会話コメントとレビューコメント（インラインコメント）を取得
- ファイル名、行番号、diff_hunk付きでフォーマット

#### PR情報の補足取得（必要に応じて）
```bash
# PR番号とタイトルを取得
gh pr view --json number,title
```

### 2. コメント分析と対応方針の決定

取得した各コメントについて以下を判断:

| 分類 | 説明 | 対応 |
|------|------|------|
| **必須対応** | バグ指摘、セキュリティ問題、ロジックエラー | 修正必須 |
| **推奨対応** | コード品質改善、可読性向上、ベストプラクティス | 修正推奨 |
| **検討対応** | 設計方針、アーキテクチャの議論 | 議論・検討 |
| **対応不要** | 質問への回答済み、好みの問題、誤解に基づく指摘 | スキップ可 |

### 3. ユーザーへの提示フォーマット

```markdown
## PRレビューコメント対応方針

### PR #<番号>: <タイトル>

#### 必須対応 (N件)
1. **[ファイル名:行番号]** コメント要約
   - レビュアー: @xxx
   - 指摘内容: ...
   - 対応方針: ...
   - 根拠: ...

#### 推奨対応 (N件)
...

#### 対応不要 (N件)
...
```

### 4. ユーザー確認

AskUserQuestion ツールで確認:
- **提示内容のまま修正**: 必須+推奨を全て修正
- **必須のみ修正**: 必須対応のみ実施
- **今はやめておく**: 修正せず終了
- **一部のみ修正**: ユーザーが対応する項目を指定

### 5. 修正実装（TDD手順）

修正を行う際は以下の手順に従う:

1. **テストコード修正** (該当するユニットテストがある場合)
   - 期待する動作を反映したテストを先に修正
   - テストが失敗することを確認

2. **実装コード修正**
   - テストが通るように実装を修正
   - `npm run typecheck && npm run check` を実行

3. **テスト実行**
   - `npm test -- --run` で全テストがパスすることを確認

4. **コミット**
   - 修正内容をコミット（レビューコメントへの対応である旨を記載）

## 注意事項

- レビュアーの意図を正確に理解する。不明な場合はユーザーに確認
- 大規模な設計変更が必要な指摘は、別タスクとして切り出すことを提案
- 対応不要と判断した場合も、その根拠を明確に説明
